with Ada.Text_IO;
with Ada.Float_Text_IO;
with Ada.Integer_Text_IO;
with Ada.Numerics.Elementary_Functions;

procedure Radar_Simulation is
   use Ada.Text_IO;
   use Ada.Float_Text_IO;
   use Ada.Integer_Text_IO;
   use Ada.Numerics.Elementary_Functions;

   type Coordinate is record
      X : Float;
      Y : Float;
      Z : Float;
   end record;

   type Velocity is record
      Vx : Float;
      Vy : Float;
      Vz : Float;
   end record;

   type Spherical_Coordinate is record
      R : Float;
      Theta : Float; -- Azimuth angle
      Phi : Float;   -- Elevation angle
   end record;

   package Singleton_Radar is
      function Instance return Coordinate;
   private
      Radar : Coordinate := (0.0, 0.0, 0.0);
   end Singleton_Radar;

   package body Singleton_Radar is
      function Instance return Coordinate is
      begin
         return Radar;
      end Instance;
   end Singleton_Radar;

   type FlyingObject is tagged record
      Position : Coordinate;
      Velocity : Velocity;
   end record;

   procedure Update_Position (Obj : in out FlyingObject; Time : Float) is
   begin
      Obj.Position.X := Obj.Position.X + Obj.Velocity.Vx * Time;
      Obj.Position.Y := Obj.Position.Y + Obj.Velocity.Vy * Time;
      Obj.Position.Z := Obj.Position.Z + Obj.Velocity.Vz * Time;
   end Update_Position;

   function To_Spherical (Radar : Coordinate; Obj : Coordinate) return Spherical_Coordinate is
      Dx, Dy, Dz, R, Theta, Phi : Float;
   begin
      Dx := Obj.X - Radar.X;
      Dy := Obj.Y - Radar.Y;
      Dz := Obj.Z - Radar.Z;
      R := Sqrt(Dx*Dx + Dy*Dy + Dz*Dz);
      Theta := Atan2(Dy, Dx) * (180.0 / Pi);  -- Convert radians to degrees
      Phi := Atan2(Dz, Sqrt(Dx*Dx + Dy*Dy)) * (180.0 / Pi);  -- Convert radians to degrees
      return (R, Theta, Phi);
   end To_Spherical;

   procedure Print_Spherical_Coordinate (Coord : Spherical_Coordinate) is
   begin
      Put_Line("R: " & Float'Image(Coord.R) & " m, Theta: " & Float'Image(Coord.Theta) & " degrees, Phi: " & Float'Image(Coord.Phi) & " degrees");
   end Print_Spherical_Coordinate;

   Radar_Position : Coordinate := Singleton_Radar.Instance;

   procedure Main is
      N : Integer;
      Time : Float;
   begin
      Put("Enter the number of flying objects: ");
      Integer_Text_IO.Get(Item => N);
      
      declare
         Flying_Objects : array(1 .. N) of FlyingObject;
      begin
         for I in 1 .. N loop
            Put("Enter coordinates (X, Y, Z) and velocities (Vx, Vy, Vz) for object " & Integer'Image(I) & ": ");
            Float_Text_IO.Get(Item => Flying_Objects(I).Position.X);
            Float_Text_IO.Get(Item => Flying_Objects(I).Position.Y);
            Float_Text_IO.Get(Item => Flying_Objects(I).Position.Z);
            Float_Text_IO.Get(Item => Flying_Objects(I).Velocity.Vx);
            Float_Text_IO.Get(Item => Flying_Objects(I).Velocity.Vy);
            Float_Text_IO.Get(Item => Flying_Objects(I).Velocity.Vz);
         end loop;

         Put_Line("Current spherical coordinates of objects relative to radar:");
         for I in 1 .. N loop
            Print_Spherical_Coordinate(To_Spherical(Radar_Position, Flying_Objects(I).Position));
         end loop;

         Put("Enter the time in seconds: ");
         Float_Text_IO.Get(Item => Time);

         for I in 1 .. N loop
            Update_Position(Flying_Objects(I), Time);
         end loop;

         Put_Line("Spherical coordinates of objects relative to radar after " & Float'Image(Time) & " seconds:");
         for I in 1 .. N loop
            Print_Spherical_Coordinate(To_Spherical(Radar_Position, Flying_Objects(I).Position));
         end loop;
      end;
   end Main;
begin
   Main;
end Radar_Simulation;
